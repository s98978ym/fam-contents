# Gemini/シミュレーション判別表示の追加

## 何をしたか

- APIレスポンスに `source: "gemini" | "simulation"` フィールドを追加 (`route.ts`)
- UIにフォールバック判別表示を追加 (`knowledge/page.tsx`)
  - シミュレーション時: amber警告バナー「Gemini API未接続のためシミュレーションモードです」
  - Gemini接続時: 緑の「Gemini」バッジを「AIが発展」ラベル横に表示
- QuickPostBox, NewPostForm の両方に `proofreadSource` stateを追加
- サーバーログに `[proofread]` プレフィックスで接続状態を出力
- CLAUDE.mdにフォールバック透明性ルールを追記

## ハマったポイント

- フォールバックがサイレントに動作していたため、ユーザーが「AIが壊れている」と認識した
- 実際はGemini APIキーが未設定（または `.env.local` 未作成/サーバー未再起動）でシミュレーションが動作していた
- UIの出力だけでは、Geminiの結果なのかシミュレーションの結果なのか判別できなかった
- フォールバックのシミュレーションが `**` 除去程度しかせず、元の文章とほぼ同じ結果を返していた

## 次回の注意点

- **サイレントフォールバックは禁止**: 外部API呼び出しがある機能では、レスポンスに必ず `source` フィールドを含め、UIで明示する
- `.env.local` の変更後は `npm run dev` の再起動が必要（Next.jsのホットリロード対象外）
- 新しいAPI連携機能を追加する際は、最初から判別表示を組み込む
