# ローカルファイルアップロードによるコンテンツ生成

## 何をしたか

- `/contents` ページに「ローカルファイル」タブを追加。Google Driveなしでもファイルをアップロードしてコンテンツ生成ができるようにした
- ドラッグ＆ドロップ + ファイル選択によるアップロードUI
- ファイル名・MIMEタイプによる自動カテゴリ分類（議事録/トランスクリプト/写真/その他）
- テキストファイルの内容をFile APIで読み取り、AI分析・生成APIに渡す仕組み
- `/contents/[id]` ウィザードでもローカルファイルの追加アップロードが可能
- analyze/generate APIがファイル内容を受け取り、Geminiプロンプトに含めるように拡張

## ハマったポイント

- sessionStorageのサイズ制限（5-10MB）: テキストファイルの内容をsessionStorageに保存するため、大きなファイルでは問題が起きうる。各ファイルの内容は3000文字に制限してAPIに渡すようにした
- `/contents/[id]` ページはGoogle OAuthが前提の設計だったため、`isLocalUpload` フラグでローカルアップロード時の認証バイパスが必要だった
- `StepFiles`コンポーネントのドラッグ＆ドロップは見た目だけで未実装だった。実際のFile処理を追加

## 次回の注意点

- `isTextFile` の判定はMIMEタイプ + 拡張子ベース。`.doc`/`.docx` は実際にはバイナリなので `File.text()` では正しく読めない可能性がある
- 画像ファイルの内容はAPIに渡していない（ファイル名のみ）。将来的にはGemini Vision APIでの画像分析も検討
- ファイル内容のトークン数管理: 大量のファイルを渡すとGeminiのコンテキストウィンドウを超える可能性あり
